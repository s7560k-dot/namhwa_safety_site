<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 - 남화토건 안전보건 자료실</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="max-w-md w-full bg-white rounded-xl shadow-lg p-8">
        <div class="text-center mb-8">
            <h1 class="text-2xl font-bold text-gray-900">남화토건(주)</h1>
            <p class="text-gray-500 mt-2">안전보건팀 자료실 로그인</p>
        </div>

        <form id="login-form" class="space-y-6">
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">이메일 (ID)</label>
                <input type="email" id="email" name="email" required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                    placeholder="example@namhwa.com">
            </div>

            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">비밀번호</label>
                <input type="password" id="password" name="password" required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                    placeholder="비밀번호 입력">
            </div>

            <div id="error-message" class="text-red-500 text-sm text-center hidden"></div>

            <button type="submit" id="submit-btn"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow transition duration-200 flex justify-center items-center">
                <span>로그인</span>
            </button>
        </form>

        <div class="mt-6 text-center text-xs text-gray-400">
            &copy; 2024 Namhwa Construction Co., Ltd.
        </div>
    </div>

    <script type="module">
        // Firebase 함수들을 CDN에서 직접 가져옵니다.
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Firebase 설정 (resource.html과 동일해야 함)
        const firebaseConfig = {
            apiKey: "AIzaSyDbVG3iL3FBJe6alPLZnhFW_QAGpzeqFoY",
            authDomain: "namhwa-safety-dashboard.firebaseapp.com",
            projectId: "namhwa-safety-dashboard",
            storageBucket: "namhwa-safety-dashboard.firebasestorage.app",
            messagingSenderId: "152864778612",
            appId: "1:152864778612:web:ecc482adce93a1534a2421"
        };

        // Firebase 초기화
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // 폼 요소 가져오기
        const loginForm = document.getElementById('login-form');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const errorMessage = document.getElementById('error-message');
        const submitBtn = document.getElementById('submit-btn');

        // 이미 로그인 되어있는지 확인
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // 이미 로그인 상태라면 바로 자료실로 이동
                goToResourcePage();
            }
        });

        // 로그인 처리 함수
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const email = emailInput.value;
            const password = passwordInput.value;

            // 로딩 상태 표시
            submitBtn.disabled = true;
            submitBtn.innerHTML = `<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
            errorMessage.classList.add('hidden');

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // 로그인 성공
                    console.log("Login successful");
                    goToResourcePage();
                })
                .catch((error) => {
                    // 로그인 실패
                    console.error("Login error", error);
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = "로그인";
                    errorMessage.classList.remove('hidden');

                    // 에러 메시지 사용자 친화적으로 변환
                    switch (error.code) {
                        case 'auth/invalid-email':
                            errorMessage.textContent = "유효하지 않은 이메일 형식입니다.";
                            break;
                        case 'auth/user-not-found':
                        case 'auth/wrong-password':
                        case 'auth/invalid-credential':
                            errorMessage.textContent = "이메일 또는 비밀번호가 올바르지 않습니다.";
                            break;
                        case 'auth/too-many-requests':
                            errorMessage.textContent = "너무 많은 로그인 시도가 있었습니다. 잠시 후 다시 시도해주세요.";
                            break;
                        default:
                            errorMessage.textContent = "로그인 중 오류가 발생했습니다: " + error.message;
                    }
                });
        });

        // 페이지 이동 함수 (프리뷰 환경 호환성 고려)
        function goToResourcePage() {
            const target = "/resource.html";
            try {
                window.location.href = target;
            } catch (e) {
                // 자동 리다이렉트 실패 시 수동 링크 표시
                document.body.innerHTML = `
                    <div class="flex items-center justify-center min-h-screen">
                        <div class="text-center">
                            <h2 class="text-2xl font-bold mb-4 text-green-600">로그인 성공!</h2>
                            <p class="mb-4">자동 이동이 차단되었습니다. 아래 버튼을 눌러주세요.</p>
                            <a href="${target}" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold">자료실로 이동</a>
                        </div>
                    </div>
                `;
            }
        }
    </script>
</body>

</html>